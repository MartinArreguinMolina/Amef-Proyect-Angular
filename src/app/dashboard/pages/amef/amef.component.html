<app-navbar/>

<div class="min-h-screen bg-base-100" data-theme="light">
  <section class="container mx-auto px-6 lg:px-12 pt-8">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <div>
        <h1 class="text-3xl md:text-4xl font-extrabold leading-tight text-base-content">Mis AMEFs</h1>
        <p class="text-base-content/70 mt-1">Crea y gestiona tus an√°lisis de modo y efecto de falla.</p>
      </div>

      @if (authService.isSuperAdmin()) {
      <a [routerLink]="['organizational-information']" class="btn bg-[#153e75] text-white shadow-sm transition-all duration-200
               hover:bg-[#123665] hover:shadow-lg hover:-translate-y-0.5
               active:translate-y-0 focus-visible:outline-none
               focus-visible:ring-2 focus-visible:ring-[#153e75]/40">
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
          <path d="M12 5v14M5 12h14" />
        </svg>
        Crear AMEF
      </a>
      }
    </div>
  </section>

  @if (authService.isSuperAdmin()) {
  <section class="container mx-auto px-6 lg:px-12 mt-6">
    <div class="flex flex-col md:flex-row gap-3 md:items-center">
      <div class="w-full md:w-auto rounded-xl border border-base-300 bg-base-100 p-2
               focus-within:ring-2 focus-within:ring-[#153e75]/30 focus-within:border-transparent transition-all">
        <div class="flex items-center gap-2">
          <label class="input input-bordered flex items-center gap-2 w-full md:w-96">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 opacity-70" viewBox="0 0 16 16" fill="currentColor"
              aria-hidden="true">
              <path fill-rule="evenodd"
                d="M9.965 11.026a5 5 0 1 1 1.06-1.06l2.755 2.754a.75.75 0 1 1-1.06 1.06l-2.755-2.754ZM10.5 7a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0Z"
                clip-rule="evenodd" />
            </svg>
            <input type="search" (input)="changeFilter(idInput.value)" #idInput class="grow"
              placeholder="Buscar por sistema, subsistema o componente"
              aria-label="Buscar AMEFs por sistema, subsistema o componente" />
          </label>

          <button type="button" (click)="idInput.value = ''; changeFilter('')"
            class="btn bg-[#153e75] text-white hover:bg-[#0f2e58]">
            Todos
          </button>
        </div>
      </div>
    </div>
  </section>
  <section class="container mx-auto px-6 lg:px-12 py-8">
    <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
      @if(amefs.isLoading()){
      <div class="col-span-full w-full min-h-56 grid place-items-center py-10" role="status" aria-busy="true">
        <app-loader class="block"></app-loader>
      </div>
      }@else{
      @for (amef of amefs.value(); track amef.amefId) {
      <amef-card [amef]="amef" />
      } @empty {
      <div class="col-span-full">
        <amef-card-not-found />
      </div>
      }
      }
    </div>
  </section>
  }


  <div class="container mx-auto px-6 lg:px-12 pb-7 pt-10">
    <div class="divider after:bg-base-300 before:bg-base-300 text-base-content/70">
      AMEFs a los que perteneces
    </div>
  </div>

  <section class="container mx-auto px-6 lg:px-12 mt-6">
    <div class="flex flex-col md:flex-row gap-3 md:items-center">
      <div class="w-full md:w-auto rounded-xl border border-base-300 bg-base-100 p-2
               focus-within:ring-2 focus-within:ring-[#153e75]/30 focus-within:border-transparent transition-all">
        <div class="flex items-center gap-2">
          <label class="input input-bordered flex items-center gap-2 w-full md:w-96">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 opacity-70" viewBox="0 0 16 16" fill="currentColor"
              aria-hidden="true">
              <path fill-rule="evenodd"
                d="M9.965 11.026a5 5 0 1 1 1.06-1.06l2.755 2.754a.75.75 0 1 1-1.06 1.06l-2.755-2.754ZM10.5 7a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0Z"
                clip-rule="evenodd" />
            </svg>
            <input type="search" (input)="changeterm(term.value)" #term class="grow"
              placeholder="Buscar por responsable o tipo de AMEF" aria-label="Buscar AMEFs por responsable o tipo" />
          </label>

          <button type="button" (click)="changeterm(''); term.value = ''"
            class="btn bg-[#153e75] text-white hover:bg-[#0f2e58]">
            Todos
          </button>
        </div>
      </div>
    </div>
  </section>

  <section class="container mx-auto px-6 lg:px-12 py-8">
    <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
      @if (amefsByTeam.isLoading()) {
      <div class="col-span-full w-full min-h-56 grid place-items-center py-10" role="status" aria-busy="true">
        <app-loader class="block"></app-loader>
      </div>
      }@else{
      @for (amef of amefsByTeam.value(); track amef.amefId) {
      <amef-card [amef]="amef" />
      } @empty {
      <div class="col-span-full">
        <amef-card-not-found />
      </div>
      }
      }
    </div>
  </section>
</div>
