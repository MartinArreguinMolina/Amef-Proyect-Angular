<div
  class="relative group select-none rounded-2xl bg-base-100 border border-base-300/80 shadow-sm
         transition-all duration-300 hover:shadow-xl hover:-translate-y-0.5 focus-within:ring-2
         focus-within:ring-[#153e75]/30 focus-within:ring-offset-2 focus-within:ring-offset-base-100">

  <!-- Ribbon / chip superior -->
  <div
    class="absolute -top-3 left-6 z-20 inline-flex items-center gap-2 max-w-[80%] md:max-w-[26rem]
           rounded-lg bg-[#153e75] text-white px-2.5 py-1.5 shadow-md
           ring-1 ring-white/10 transition-transform duration-300 group-hover:-translate-y-0.5"
    aria-label="Preparado por">
    <div
      class="w-6 h-6 rounded-full bg-white/15 grid place-items-center text-[11px] font-bold uppercase">
      {{ (amef().preparedBy.fullName || '—')?.[0] || '•' }}
    </div>
    <span class="text-xs font-medium truncate"
          [title]="amef().preparedBy.fullName || '—'">
      {{ amef().preparedBy.fullName | titlecase }}
    </span>
  </div>

  <!-- Acento lateral sutil -->
  <div class="absolute inset-y-0 left-0 w-1.5 rounded-l-2xl bg-gradient-to-b from-[#153e75] via-[#0f2e58] to-[#153e75]"></div>

  <!-- Fondo decorativo muy suave (no compite con el contenido) -->
  <div class="absolute inset-0 pointer-events-none">
    <div class="absolute -top-20 -right-24 w-72 h-72 rounded-full bg-[#153e75]/10 blur-2xl
                transition-opacity duration-300 group-hover:opacity-80"></div>
  </div>

  <!-- Header del card -->
  <div class="px-6 pt-7 pb-2">
    <div class="flex items-start justify-between gap-3">
      <div class="flex items-center gap-2 min-w-0">
        <svg class="w-5 h-5 text-[#153e75] shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" aria-hidden="true">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
          <path d="M14 2v6h6" />
        </svg>
        <h3 class="text-lg font-semibold text-base-content truncate" [title]="amef().amefId">
          {{ amef().amefId }}
        </h3>
      </div>
    </div>

    <!-- Chips de metadatos -->
    <div class="mt-3 flex flex-wrap items-center gap-2 text-sm">
      @if (amef().system) {
        <span class="inline-flex items-center gap-1 rounded-md border border-base-300/80 bg-base-100 px-2 py-1 text-xs">
          <svg class="w-3.5 h-3.5 text-base-content/60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M3 12h18M3 6h18M3 18h18" /></svg>
          <span class="text-base-content/60">Sistema:</span>
          <span class="font-mono">{{ amef().system }}</span>
        </span>
      }
      @if (amef().subsystem) {
        <span class="inline-flex items-center gap-1 rounded-md border border-base-300/80 bg-base-100 px-2 py-1 text-xs">
          <svg class="w-3.5 h-3.5 text-base-content/60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M4 6h16M4 12h10M4 18h4" /></svg>
          <span class="text-base-content/60">Subsistema:</span>
          <span class="font-mono">{{ amef().subsystem }}</span>
        </span>
      }
      @if (amef().component) {
        <span class="inline-flex items-center gap-1 rounded-md border border-base-300/80 bg-base-100 px-2 py-1 text-xs">
          <svg class="w-3.5 h-3.5 text-base-content/60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M12 2v20M2 12h20" /></svg>
          <span class="text-base-content/60">Componente:</span>
          <span class="font-mono">{{ amef().component }}</span>
        </span>
      }
    </div>
  </div>

  <!-- Divider suave -->
  <div class="mx-6 h-px bg-gradient-to-r from-transparent via-base-300 to-transparent"></div>

  <!-- Footer del card -->
  <div class="px-6 py-4">
    <div class="flex items-center justify-between gap-3">
      <!-- Acciones -->
      <div class="join">
        <button
          type="button"
          (click)="openPdf(amef().amefId)"
          class="btn join-item border-base-300/80 text-base-content hover:border-[#153e75]/40 hover:bg-[#153e75]/5
                 transition-all duration-150 hover:-translate-y-0.5 hover:shadow-sm
                 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#153e75]/30"
          aria-label="Ver PDF"
          title="Ver PDF">
          <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" aria-hidden="true">
            <path d="M4 4h16v16H4z" /><path d="M8 8h8M8 12h5M8 16h8" />
          </svg>
          <span class="hidden sm:inline">Ver PDF</span>
        </button>

        <button
          type="button"
          (click)="downloadExcel(amef().amefId)"
          class="btn join-item border-base-300/80 text-base-content hover:border-[#153e75]/40 hover:bg-[#153e75]/5
                 transition-all duration-150 hover:-translate-y-0.5 hover:shadow-sm
                 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#153e75]/30"
          aria-label="Descargar Excel"
          title="Descargar Excel">
          <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" aria-hidden="true">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
            <path d="M7 10l5 5 5-5" />
            <path d="M12 15V3" />
          </svg>
          <span class="hidden sm:inline">Excel</span>
        </button>
      </div>

      <!-- CTA principal -->
      @if (authService.rol()) {
        <a [routerLink]="['amef', amef().amefId, 'analysis']"
           class="btn btn-primary bg-[#153e75] border-[#153e75] hover:bg-[#0f2e58] hover:border-[#0f2e58]
                  transition-all duration-200 hover:shadow-lg hover:-translate-y-0.5
                  focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#153e75]/30">
          Abrir análisis
        </a>
      }
    </div>

    <!-- Responsable -->
    <div class="mt-5 flex items-center gap-2 min-w-0">
      <div class="w-8 h-8 rounded-full bg-[#153e75]/15 text-[#153e75] grid place-items-center
                  text-sm font-bold uppercase transition-transform duration-200 group-hover:scale-110">
        {{ (amef().preparedBy.fullName || '—')?.[0] || '•' }}
      </div>
      <div class="min-w-0">
        <p class="text-xs text-base-content/60 leading-tight">Responsable</p>
        <p class="text-sm font-medium text-base-content break-words">
          {{ amef().preparedBy.fullName | titlecase }}
        </p>
      </div>
    </div>
  </div>
</div>
