<div class="relative block group select-none rounded-2xl focus:outline-none
               ring-0 ring-[#153e75]/0 hover:ring-2 hover:ring-[#153e75]/25
               hover:ring-offset-2 hover:ring-offset-base-100 transition-all duration-200">
  <div class="absolute -top-4 left-8 h-9 max-w-[70%] md:max-w-[22rem] pr-3 pl-2 rounded-t-lg
                 bg-[#153e75] text-white shadow-md flex items-center gap-2 z-20
                 transition-transform duration-200 group-hover:-translate-y-0.5">
    <div class="w-5 h-5 rounded-full bg-white/20 grid place-items-center text-[10px] font-bold uppercase">
      {{ (amef().preparedBy.fullName || '—')?.[0] || '•' }}
    </div>
    <span class="text-xs font-medium truncate" [title]="amef().preparedBy.fullName || '—'">
      {{ amef().preparedBy.fullName | titlecase }}
    </span>
  </div>

  <div class="relative overflow-hidden rounded-2xl border border-base-300 bg-base-100 shadow-sm
                 transition-all duration-300 group-hover:shadow-xl group-hover:-translate-y-0.5
                 group-hover:border-[#153e75]/30">
    <div class="absolute inset-y-0 left-0 w-1.5 bg-gradient-to-b from-[#153e75] via-[#0f2e58] to-[#153e75]"></div>
    <div class="h-2 bg-gradient-to-r from-base-200 via-base-300 to-base-200"></div>

    <div class="absolute inset-0 pointer-events-none">
      <div class="absolute inset-0 opacity-40"
        style="background-image: radial-gradient(var(--fallback-bc,oklch(var(--bc)/.04)) 1px, transparent 1px); background-size: 14px 14px;">
      </div>
      <div class="absolute -top-24 -right-24 w-64 h-64 rounded-full bg-[#153e75]/10 blur-2xl
                        transition-opacity duration-300 group-hover:opacity-80"></div>
    </div>

    <div class="relative p-5 pt-7 pl-6">
      <div class="flex items-start justify-between gap-3">
        <div class="flex items-center gap-2 min-w-0">
          <svg class="w-5 h-5 text-[#153e75] shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor"
            stroke-width="1.8">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
            <path d="M14 2v6h6" />
          </svg>
          <h3 class="text-lg font-semibold text-base-content truncate">{{ amef().amefId }}</h3>
        </div>
      </div>

      <div class="mt-3 flex flex-wrap items-center gap-2 text-sm">
        @if (amef().system) {
        <span
          class="inline-flex items-center gap-1 rounded-md border border-base-300 bg-base-100 px-2 py-1
                            text-xs text-base-content/70 transition-all group-hover:border-[#153e75]/40 hover:bg-base-200/60">
          <svg class="w-3.5 h-3.5 text-slate-500" viewBox="0 0 24 24" fill="none" stroke="currentColor"
            stroke-width="1.8">
            <path d="M3 12h18M3 6h18M3 18h18" />
          </svg>
          <span class="text-slate-500">Sistema:</span>
          <span class="font-mono">{{ amef().system || '—' }}</span>
        </span>
        }
        @if (amef().subsystem) {
        <span
          class="inline-flex items-center gap-1 rounded-md border border-base-300 bg-base-100 px-2 py-1
                            text-xs text-base-content/70 transition-all group-hover:border-[#153e75]/40 hover:bg-base-200/60">
          <svg class="w-3.5 h-3.5 text-slate-500" viewBox="0 0 24 24" fill="none" stroke="currentColor"
            stroke-width="1.8">
            <path d="M4 6h16M4 12h10M4 18h4" />
          </svg>
          <span class="text-slate-500">Subsistema:</span>
          <span class="font-mono">{{ amef().subsystem || '—' }}</span>
        </span>
        }
        @if (amef().component) {
        <span
          class="inline-flex items-center gap-1 rounded-md border border-base-300 bg-base-100 px-2 py-1
                            text-xs text-base-content/70 transition-all group-hover:border-[#153e75]/40 hover:bg-base-200/60">
          <svg class="w-3.5 h-3.5 text-slate-500" viewBox="0 0 24 24" fill="none" stroke="currentColor"
            stroke-width="1.8">
            <path d="M12 2v20M2 12h20" />
          </svg>
          <span class="text-slate-500">Componente:</span>
          <span class="font-mono">{{ amef().component || '—' }}</span>
        </span>
        }
      </div>

      <div class="pt-3 flex items-center justify-between gap-3">
        <div class="join">
          <button (click)="openPdf(amef().amefId)" class="btn btn-outline join-item transition-all duration-150
                         hover:-translate-y-0.5 hover:shadow-sm
                         focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#153e75]/30"
            aria-label="Ver PDF" title="Ver PDF">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
              <path d="M4 4h16v16H4z" />
              <path d="M8 8h8M8 12h5M8 16h8" />
            </svg>
            <span class="hidden sm:inline">Ver PDF</span>
          </button>
        </div>

        @if(authService.rol()){
        <a [routerLink]="['amef', amef().amefId, 'analysis']" class="btn btn-primary transition-all duration-200
                         hover:shadow-lg hover:-translate-y-0.5
                         focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#153e75]/30">
          Abrir análisis
        </a>
        }
      </div>

      <div class="mt-4 h-px bg-gradient-to-r from-transparent via-base-300 to-transparent"></div>

      <div class="mt-4 flex items-center justify-between">
        <div class="flex items-center gap-2 min-w-0">
          <div class="w-7 h-7 rounded-full bg-[#153e75]/10 text-[#153e75] grid place-items-center text-xs font-bold uppercase
                         transition-transform duration-200 group-hover:scale-110">
            {{ (amef().preparedBy.fullName || '—')?.[0] || '•' }}
          </div>
          <div class="min-w-0">
            <p class="text-xs text-base-content/60 leading-tight">Responsable</p>
            <p class="text-sm font-medium text-base-content whitespace-normal break-words">
              {{ amef().preparedBy.fullName | titlecase }}
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
